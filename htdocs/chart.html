<html>
  <head>
    <script src="http://yui.yahooapis.com/3.4.1/build/yui/yui-min.js"></script>
    <script type="text/javascript" src="jquery-1.6.4.js"></script>
    <style scoped>
      #mychart {
      margin:10px 10px 10px 10px;
      width: 400px;
      height:400px;
      }
    </style>
  </head>
  <body class="yui3-skin-sam">
    <div id="mychart"></div>
    <script type="text/javascript">
      (function() {
        YUI().use('charts', 'io-base', function (Y) { 

        if (window.XMLHttpRequest) {
          xmlhttp=new XMLHttpRequest();
        } else {
          xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.open("GET","get-tasks",false);
        xmlhttp.send();
        xmlDoc=xmlhttp.responseXML; 
        var tasks = xmlDoc.getElementsByTagName("task");
        var myDataValues = new Array();

        for (i=0;i<tasks.length;i++) {
          var category = tasks[i].getElementsByTagName("category")[0];
          var value = tasks[i].getElementsByTagName("hours")[0];
          var exists = false;
          for(j=0;j<myDataValues.length;j++) {
            if (myDataValues[j].category == category.firstChild.nodeValue) {
                myDataValues[j].hours += parseFloat(value.firstChild.nodeValue);
                exists = true;
                break;
            }
          }   
          if (!exists)
            myDataValues.push({"category":category.firstChild.nodeValue, "hours":parseFloat(value.firstChild.nodeValue)});
        }

        var pieGraph = new Y.Chart({
            render:"#mychart", 
            categoryKey:"category",
            seriesKeys:["hours"], 
            dataProvider:myDataValues, 
            type:"pie",
            seriesCollection:[
                {
                    categoryKey:"category",
                    valueKey:"hours"
                }
            ]
        });
       });
     })();
        </script>
    </body>
</html>
